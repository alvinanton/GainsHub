@model IEnumerable<GainsHub.Models.Product>

<h2 class="mb-4">Available Products</h2>

@{
    var noProductsMessage = ViewData["NoProductsMessage"] as string;
    var categories = ViewData["Categories"] as List<GainsHub.Models.Category>;
    int? selectedCategory = ViewData["SelectedCategory"] as int?;
}

<!-- Category Filter -->
<div class="mb-3">
    <form method="get" asp-action="Index">
        <div class="form-group">
            <label for="categoryFilter"><strong>Filter by Category</strong></label>
            <select id="categoryFilter" name="categoryId" class="form-control" onchange="this.form.submit()">
                <option value="">All Categories</option>
                @foreach (var category in categories)
                {
                    <option value="@category.Id" selected="@(selectedCategory == category.Id ? "selected" : null)">
                        @category.Name
                    </option>
                }
            </select>
        </div>
    </form>
</div>

<!-- No Products Message -->
@if (!string.IsNullOrEmpty(noProductsMessage))
{
    <div class="alert alert-warning text-center">
        @noProductsMessage
        <a href="@Url.Action("Index", "Product")" class="btn btn-link">Go back to products list</a>
    </div>
}
else
{
    <div class="container mt-4">
        <div class="row">
            @foreach (var product in Model)
            {
                <div class="col-md-4 mb-4">
                    <div class="card h-100 shadow-sm">
                        <img src="@(!string.IsNullOrEmpty(product.ImageUrl) ? product.ImageUrl : "/images/default-product.png")"
                             class="card-img-top"
                             alt="@product.Name">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">@product.Name</h5>
                            <p class="card-text text-muted">@product.Description</p>
                            <p class="card-text"><strong>@product.Price.ToString("C")</strong></p>
                            <div class="mt-auto d-flex justify-content-center gap-3">
                                <a class="btn btn-info btn-lg flex-grow-2" asp-action="Details" asp-route-id="@product.Id">View Details</a>
                                <a class="btn btn-success btn-lg flex-grow-2" asp-action="AddToCart" asp-route-id="@product.Id">
                                    <i class="bi bi-cart-plus"></i> Add to Cart
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
}

@{
    int totalPages = ViewData["TotalPages"] as int? ?? 1;
    int currentPage = ViewData["CurrentPage"] as int? ?? 1;
    int maxPageToShow = 5; // Show 5 pages max
}

<!-- Pagination Controls -->
<nav aria-label="Product Pagination">
    <ul class="pagination justify-content-center" >
        <!-- First Page (<<) -->
        <li class="page-item @(currentPage == 1 ? "disabled" : "")">
            <a class="page-link" href="?page=1&categoryId=@selectedCategory">
                <i class="bi bi-chevron-double-left"></i>
            </a>
        </li>

        <!-- Previous (<) -->
        <li class="page-item @(currentPage == 1 ? "disabled" : "")">
            <a class="page-link" href="?page=@(currentPage - 1)&categoryId=@selectedCategory">
                <i class="bi bi-chevron-left"></i>
            </a>
        </li>

        <!-- Page Numbers (1-5) -->
        @for (int i = 1; i <= Math.Min(totalPages, maxPageToShow); i++)
        {
            <li class="page-item @(i == currentPage ? "active" : "")">
                <a class="page-link" href="?page=@i&categoryId=@selectedCategory">@i</a>
            </li>
        }

        <!-- Next (>) -->
        <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
            <a class="page-link" href="?page=@(currentPage + 1)&categoryId=@selectedCategory">
                <i class="bi bi-chevron-right"></i>
            </a>
        </li>

        <!-- Last Page (>>) -->
        <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
            <a class="page-link" href="?page=@totalPages&categoryId=@selectedCategory">
                <i class="bi bi-chevron-double-right"></i>
            </a>
        </li>
    </ul>
</nav>

    
        